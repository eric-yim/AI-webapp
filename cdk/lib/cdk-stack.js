"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CdkStack = void 0;
const cdk = require("aws-cdk-lib");
const logs = require("aws-cdk-lib/aws-logs");
const lambda = require("aws-cdk-lib/aws-lambda");
const apigateway = require("aws-cdk-lib/aws-apigateway");
const iam = require("aws-cdk-lib/aws-iam");
const dynamodb = require("aws-cdk-lib/aws-dynamodb");
const PAYPAL_SANDBOX = SeeREADME;
const PAYPAL_SANDBOX_SECRET = SeeREADME;
class CdkStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        const userTable = new dynamodb.Table(this, 'UserTable', {
            partitionKey: { name: 'uid', type: dynamodb.AttributeType.STRING },
            tableName: 'UserTable',
            removalPolicy: cdk.RemovalPolicy.RETAIN,
            billingMode: dynamodb.BillingMode.PAY_PER_REQUEST
        });
        const paymentsTable = new dynamodb.Table(this, 'PaymentsTable', {
            partitionKey: { name: 'paymentProvider', type: dynamodb.AttributeType.STRING },
            sortKey: { name: 'uidOrderId', type: dynamodb.AttributeType.STRING },
            tableName: 'PaymentsTable',
            removalPolicy: cdk.RemovalPolicy.RETAIN,
            billingMode: dynamodb.BillingMode.PAY_PER_REQUEST,
        });
        const cfnTable = paymentsTable.node.defaultChild;
        cfnTable.addPropertyOverride('TimeToLiveSpecification', {
            AttributeName: 'tokenTTL',
            Enabled: true,
        });
        const javaLambda = new lambda.Function(this, 'resumeAIBackend', {
            runtime: lambda.Runtime.JAVA_17,
            handler: 'com.resumeai.LambdaHandler::handleRequest',
            code: lambda.Code.fromAsset('../backend/target/backend-1.0-SNAPSHOT.jar'),
            memorySize: 2000,
            timeout: cdk.Duration.seconds(30),
            logRetention: logs.RetentionDays.ONE_YEAR,
            environment: {
                USER_TABLE: userTable.tableName,
                PRODUCT_TABLE: paymentsTable.tableName,
                PAYPAL_APIKEY: PAYPAL_SANDBOX,
                PAYPAL_SECRET: PAYPAL_SANDBOX_SECRET,
            },
        });
        userTable.grantReadWriteData(javaLambda);
        paymentsTable.grantReadWriteData(javaLambda);
        javaLambda.addToRolePolicy(new iam.PolicyStatement({
            actions: ['dynamodb:BatchGetItem', 'dynamodb:BatchWriteItem'],
            resources: [userTable.tableArn, paymentsTable.tableArn],
        }));
        javaLambda.addToRolePolicy(new iam.PolicyStatement({
            actions: ['bedrock:InvokeModel'],
            resources: ['*'],
        }));
        const backendApi = new apigateway.RestApi(this, 'backendApi', {
            restApiName: 'backendApi',
            cloudWatchRole: true
        });
        const integration = new apigateway.LambdaIntegration(javaLambda);
        const usersApi = backendApi.root.addResource('users');
        usersApi.addMethod('POST', integration);
        usersApi.addMethod("GET", integration);
        const productsApi = backendApi.root.addResource('products');
        productsApi.addMethod('POST', integration);
        const productsCaptureApi = backendApi.root.addResource('products-capture');
        productsCaptureApi.addMethod('POST', integration);
        backendApi.addUsagePlan('UsagePlan', {
            name: 'DefaultThrottling',
            throttle: {
                rateLimit: 1000, // average requests per second over an extended period of time
                burstLimit: 2500 // Limit over a few seconds
            }
        });
        const cloudFrontUrl = 'https://' + cdk.Fn.importValue('CloudFrontUrl');
        const corsOptions = {
            allowOrigins: [
                cloudFrontUrl,
            ],
            allowMethods: ['GET', 'POST', 'OPTIONS'],
            allowHeaders: ['Content-Type', 'Authorization', 'Access-Control-Allow-Origin', 'Access-Control-Allow-Credentials']
        };
        usersApi.addCorsPreflight(corsOptions);
        productsApi.addCorsPreflight(corsOptions);
        productsCaptureApi.addCorsPreflight(corsOptions);
        javaLambda.grantInvoke(new iam.ServicePrincipal('apigateway.amazonaws.com'));
    }
}
exports.CdkStack = CdkStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrLXN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2RrLXN0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUFtQztBQUVuQyw2Q0FBNkM7QUFDN0MsaURBQWlEO0FBQ2pELHlEQUF5RDtBQUN6RCwyQ0FBMkM7QUFDM0MscURBQXFEO0FBRXJELE1BQU0sY0FBYyxHQUFHLGtGQUFrRixDQUFDO0FBQzFHLE1BQU0scUJBQXFCLEdBQUcsa0ZBQWtGLENBQUM7QUFFakgsTUFBYSxRQUFTLFNBQVEsR0FBRyxDQUFDLEtBQUs7SUFDckMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFzQjtRQUM5RCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUV4QixNQUFNLFNBQVMsR0FBRyxJQUFJLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRTtZQUN0RCxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRTtZQUNsRSxTQUFTLEVBQUUsV0FBVztZQUN0QixhQUFhLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxNQUFNO1lBQ3ZDLFdBQVcsRUFBRSxRQUFRLENBQUMsV0FBVyxDQUFDLGVBQWU7U0FDbEQsQ0FBQyxDQUFDO1FBRUgsTUFBTSxhQUFhLEdBQUcsSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxlQUFlLEVBQUU7WUFDOUQsWUFBWSxFQUFFLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRTtZQUM5RSxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRTtZQUNwRSxTQUFTLEVBQUUsZUFBZTtZQUMxQixhQUFh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RUFBRSxJQUFJLENBQUMsMkJBQTJCO2FBQzdDO1NBQ0YsQ0FDRixDQUFBO1FBRUQsTUFBTSxhQUFhLEdBQUcsVUFBVSxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3ZFLE1BQU0sV0FBVyxHQUEyQjtZQUMxQyxZQUFZLEVBQUU7Z0JBQ1osYUFBYTthQUNkO1lBQ0QsWUFBWSxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLENBQUM7WUFDeEMsWUFBWSxFQUFFLENBQUMsY0FBYyxFQUFFLGVBQWUsRUFBRSw2QkFBNkIsRUFBRSxrQ0FBa0MsQ0FBQztTQUNuSCxDQUFDO1FBQ0YsUUFBUSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3ZDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMxQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUVqRCxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksR0FBRyxDQUFDLGdCQUFnQixDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQztJQUMvRSxDQUFDO0NBQ0Y7QUEvRkQsNEJBK0ZDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0ICogYXMgbG9ncyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbG9ncyc7XG5pbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSAnYXdzLWNkay1saWIvYXdzLWxhbWJkYSc7XG5pbXBvcnQgKiBhcyBhcGlnYXRld2F5IGZyb20gJ2F3cy1jZGstbGliL2F3cy1hcGlnYXRld2F5JztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIGR5bmFtb2RiIGZyb20gJ2F3cy1jZGstbGliL2F3cy1keW5hbW9kYic7XG5cbmNvbnN0IFBBWVBBTF9TQU5EQk9YID0gXCJBUnktUTg2dmhxZ3ljMnM0UHgyM0ZHMFBnb1YyMVVad1NGSW9zZERsY3Fyd3h4VmdfalZwSjJHbUtxcmNuYXlSbG9kcXRsVkw5eFh0OWc4M1wiO1xuY29uc3QgUEFZUEFMX1NBTkRCT1hfU0VDUkVUID0gXCJFREljd2dfdjA4NU8wZmVZeTdYQVdVWVNtTkRsX0I4MHp4cXB3TEYtbWEwZVktMHE3Mk9mWG9XRTIxM2lGYUJDWlExVXZaUlFmV3VYdXBHZFwiO1xuXG5leHBvcnQgY2xhc3MgQ2RrU3RhY2sgZXh0ZW5kcyBjZGsuU3RhY2sge1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wcz86IGNkay5TdGFja1Byb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG5cbiAgICBjb25zdCB1c2VyVGFibGUgPSBuZXcgZHluYW1vZGIuVGFibGUodGhpcywgJ1VzZXJUYWJsZScsIHtcbiAgICAgIHBhcnRpdGlvbktleTogeyBuYW1lOiAndWlkJywgdHlwZTogZHluYW1vZGIuQXR0cmlidXRlVHlwZS5TVFJJTkcgfSxcbiAgICAgIHRhYmxlTmFtZTogJ1VzZXJUYWJsZScsXG4gICAgICByZW1vdmFsUG9saWN5OiBjZGsuUmVtb3ZhbFBvbGljeS5SRVRBSU4sXG4gICAgICBiaWxsaW5nTW9kZTogZHluYW1vZGIuQmlsbGluZ01vZGUuUEFZX1BFUl9SRVFVRVNUXG4gICAgfSk7XG5cbiAgICBjb25zdCBwYXltZW50c1RhYmxlID0gbmV3IGR5bmFtb2RiLlRhYmxlKHRoaXMsICdQYXltZW50c1RhYmxlJywge1xuICAgICAgcGFydGl0aW9uS2V5OiB7IG5hbWU6ICdwYXltZW50UHJvdmlkZXInLCB0eXBlOiBkeW5hbW9kYi5BdHRyaWJ1dGVUeXBlLlNUUklORyB9LFxuICAgICAgc29ydEtleTogeyBuYW1lOiAndWlkT3JkZXJJZCcsIHR5cGU6IGR5bmFtb2RiLkF0dHJpYnV0ZVR5cGUuU1RSSU5HIH0sICBcbiAgICAgIHRhYmxlTmFtZTogJ1BheW1lbnRzVGFibGUnLFxuICAgICAgcmVtb3ZhbFBvbGljeTogY2RrLlJlbW92YWxQb2xpY3kuUkVUQUlOLCBcbiAgICAgIGJpbGxpbmdNb2RlOiBkeW5hbW9kYi5CaWxsaW5nTW9kZS5QQVlfUEVSX1JFUVVFU1QsXG4gICAgfSk7XG5cbiAgICBjb25zdCBjZm5UYWJsZSA9IHBheW1lbnRzVGFibGUubm9kZS5kZWZhdWx0Q2hpbGQgYXMgZHluYW1vZGIuQ2ZuVGFibGU7XG4gICAgY2ZuVGFibGUuYWRkUHJvcGVydHlPdmVycmlkZSgnVGltZVRvTGl2ZVNwZWNpZmljYXRpb24nLCB7XG4gICAgICBBdHRyaWJ1dGVOYW1lOiAndG9rZW5UVEwnLFxuICAgICAgRW5hYmxlZDogdHJ1ZSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGphdmFMYW1iZGEgPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHRoaXMsICdyZXN1bWVBSUJhY2tlbmQnLCB7XG4gICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5KQVZBXzE3LCBcbiAgICAgIGhhbmRsZXI6ICdjb20ucmVzdW1lYWkuTGFtYmRhSGFuZGxlcjo6aGFuZGxlUmVxdWVzdCcsIFxuICAgICAgY29kZTogbGFtYmRhLkNvZGUuZnJvbUFzc2V0KCcuLi9iYWNrZW5kL3RhcmdldC9iYWNrZW5kLTEuMC1TTkFQU0hPVC5qYXInKSxcbiAgICAgIG1lbW9yeVNpemU6IDIwMDAsIFxuICAgICAgdGltZW91dDogY2RrLkR1cmF0aW9uLnNlY29uZHMoMzApLFxuICAgICAgbG9nUmV0ZW50aW9uOiBsb2dzLlJldGVudGlvbkRheXMuT05FX1lFQVIsXG4gICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICBVU0VSX1RBQkxFOiB1c2VyVGFibGUudGFibGVOYW1lLCBcbiAgICAgICAgUFJPRFVDVF9UQUJMRTogcGF5bWVudHNUYWJsZS50YWJsZU5hbWUsIFxuICAgICAgICBQQVlQQUxfQVBJS0VZOiBQQVlQQUxfU0FOREJPWCxcbiAgICAgICAgUEFZUEFMX1NFQ1JFVDogUEFZUEFMX1NBTkRCT1hfU0VDUkVULFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHVzZXJUYWJsZS5ncmFudFJlYWRXcml0ZURhdGEoamF2YUxhbWJkYSk7XG4gICAgcGF5bWVudHNUYWJsZS5ncmFudFJlYWRXcml0ZURhdGEoamF2YUxhbWJkYSk7XG5cbiAgICBqYXZhTGFtYmRhLmFkZFRvUm9sZVBvbGljeShuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICBhY3Rpb25zOiBbJ2R5bmFtb2RiOkJhdGNoR2V0SXRlbScsICdkeW5hbW9kYjpCYXRjaFdyaXRlSXRlbSddLFxuICAgICAgcmVzb3VyY2VzOiBbdXNlclRhYmxlLnRhYmxlQXJuLCBwYXltZW50c1RhYmxlLnRhYmxlQXJuXSxcbiAgICB9KSk7XG5cbiAgICBqYXZhTGFtYmRhLmFkZFRvUm9sZVBvbGljeShuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICBhY3Rpb25zOiBbJ2JlZHJvY2s6SW52b2tlTW9kZWwnXSxcbiAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgfSkpO1xuICAgIFxuICAgIGNvbnN0IGJhY2tlbmRBcGkgPSBuZXcgYXBpZ2F0ZXdheS5SZXN0QXBpKHRoaXMsICdiYWNrZW5kQXBpJywge1xuICAgICAgcmVzdEFwaU5hbWU6ICdiYWNrZW5kQXBpJyxcbiAgICAgIGNsb3VkV2F0Y2hSb2xlOiB0cnVlXG4gICAgfSk7XG5cblxuICAgIGNvbnN0IGludGVncmF0aW9uID0gbmV3IGFwaWdhdGV3YXkuTGFtYmRhSW50ZWdyYXRpb24oamF2YUxhbWJkYSk7XG5cbiAgICBjb25zdCB1c2Vyc0FwaSA9IGJhY2tlbmRBcGkucm9vdC5hZGRSZXNvdXJjZSgndXNlcnMnKTtcbiAgICB1c2Vyc0FwaS5hZGRNZXRob2QoJ1BPU1QnLCBpbnRlZ3JhdGlvbik7XG4gICAgdXNlcnNBcGkuYWRkTWV0aG9kKFwiR0VUXCIsIGludGVncmF0aW9uKTtcblxuICAgIGNvbnN0IHByb2R1Y3RzQXBpID0gYmFja2VuZEFwaS5yb290LmFkZFJlc291cmNlKCdwcm9kdWN0cycpO1xuICAgIHByb2R1Y3RzQXBpLmFkZE1ldGhvZCgnUE9TVCcsIGludGVncmF0aW9uKTtcblxuICAgIGNvbnN0IHByb2R1Y3RzQ2FwdHVyZUFwaSA9IGJhY2tlbmRBcGkucm9vdC5hZGRSZXNvdXJjZSgncHJvZHVjdHMtY2FwdHVyZScpO1xuICAgIHByb2R1Y3RzQ2FwdHVyZUFwaS5hZGRNZXRob2QoJ1BPU1QnLCBpbnRlZ3JhdGlvbik7XG5cbiAgICBiYWNrZW5kQXBpLmFkZFVzYWdlUGxhbignVXNhZ2VQbGFuJyxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0RlZmF1bHRUaHJvdHRsaW5nJyxcbiAgICAgICAgdGhyb3R0bGU6IHtcbiAgICAgICAgICByYXRlTGltaXQ6IDEwMDAsIC8vIGF2ZXJhZ2UgcmVxdWVzdHMgcGVyIHNlY29uZCBvdmVyIGFuIGV4dGVuZGVkIHBlcmlvZCBvZiB0aW1lXG4gICAgICAgICAgYnVyc3RMaW1pdDogMjUwMCAvLyBMaW1pdCBvdmVyIGEgZmV3IHNlY29uZHNcbiAgICAgICAgfVxuICAgICAgfVxuICAgIClcblxuICAgIGNvbnN0IGNsb3VkRnJvbnRVcmwgPSAnaHR0cHM6Ly8nICsgY2RrLkZuLmltcG9ydFZhbHVlKCdDbG91ZEZyb250VXJsJyk7XG4gICAgY29uc3QgY29yc09wdGlvbnM6IGFwaWdhdGV3YXkuQ29yc09wdGlvbnMgPSB7XG4gICAgICBhbGxvd09yaWdpbnM6IFsgXG4gICAgICAgIGNsb3VkRnJvbnRVcmwsXG4gICAgICBdLCBcbiAgICAgIGFsbG93TWV0aG9kczogWydHRVQnLCAnUE9TVCcsICdPUFRJT05TJ10sXG4gICAgICBhbGxvd0hlYWRlcnM6IFsnQ29udGVudC1UeXBlJywgJ0F1dGhvcml6YXRpb24nLCAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJywgJ0FjY2Vzcy1Db250cm9sLUFsbG93LUNyZWRlbnRpYWxzJ11cbiAgICB9O1xuICAgIHVzZXJzQXBpLmFkZENvcnNQcmVmbGlnaHQoY29yc09wdGlvbnMpO1xuICAgIHByb2R1Y3RzQXBpLmFkZENvcnNQcmVmbGlnaHQoY29yc09wdGlvbnMpO1xuICAgIHByb2R1Y3RzQ2FwdHVyZUFwaS5hZGRDb3JzUHJlZmxpZ2h0KGNvcnNPcHRpb25zKTtcblxuICAgIGphdmFMYW1iZGEuZ3JhbnRJbnZva2UobmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdhcGlnYXRld2F5LmFtYXpvbmF3cy5jb20nKSk7XG4gIH1cbn1cbiJdfQ==
